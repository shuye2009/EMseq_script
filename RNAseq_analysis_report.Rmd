---
title: "RNA-seq Analysis Report: Output File Summary"
output: pdf_document
date: "`r format(Sys.time(), '%Y-%m-%d')`"
author: "Shuye Pu"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

# Introduction

This report provides a detailed summary of the output files generated by the `RNAseq_enrichment_analysis.R` script.

The report is structured as follows: 
1.  Experimental design and pairwise comparisons.
2.  Multi-factor differential expression analysis to model time and dose effects.
3.  Standard single-factor (pairwise) differential expression analysis.

The outputs for each stage are described below.

# 1. Experimental Design

This section details the experimental design of the RNA-seq experiment. The experimental design is saved in the `design.tsv` file. 
```{r sample-design, echo=FALSE}
library(knitr)
design_file <- "C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/config/design.tsv"
design_data <- read.delim(design_file, header = TRUE, sep = "\t")
# The file has an empty last line, remove it if it was read in
design_data <- design_data[rowSums(is.na(design_data)) != ncol(design_data), ]
knitr::kable(design_data, caption = "Sample Design Overview")
```

The specific pairwise comparisons performed are listed in the table below. 
```{r comparisons-table, echo=FALSE}
library(knitr)
# Define the path to the comparisons file
comparisons_file <- "C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/config/comparisons.tsv"

# Read the comparison pairs
comparisons_df <- read.delim(comparisons_file, header = TRUE, sep = "\t")

# Remove potential empty last line
comparisons_df <- comparisons_df[rowSums(is.na(comparisons_df)) != ncol(comparisons_df), ]

# Define the shorthand names as used in the analysis script
shorthand_names <- c("2Gy24h_vs_NIR", "2Gy6d_vs_NIR", "10Gy24h_vs_NIR", "10Gy6d_vs_NIR", "2Gy6d_vs_2Gy24h", "10Gy6d_vs_10Gy24h", "10Gy24h_vs_2Gy24h", "10Gy6d_vs_2Gy6d")

# Add the shorthand names as a new column to the data frame
comparisons_df$"Comparison" <- shorthand_names

# Rename columns for clarity in the report
colnames(comparisons_df) <- c("Condition 1 (Control/Base)", "Condition 2 (Test)", "Comparison")
comparisons_df <- comparisons_df[, c("Comparison", "Condition 1 (Control/Base)", "Condition 2 (Test)")]

# Generate the table
knitr::kable(comparisons_df, caption = "Pairwise Comparisons")
```


# 2. Differential Expression and Enrichment Analysis Outputs

This section details the outputs from both the multi-factor and single-factor differential expression analyses with DESeq2.

## 2.1 Multi-Factor Analysis (Time & Dose)

This analysis models the effects of `time`, `dose`, and their `interaction`. Outputs are saved in the `multi_factor_analysis` directory.

### Main Results Tables

*   **`time_effect_DESeq2_results.csv`**: Full DESeq2 results for the main effect of time (6d vs. 24h).
*   **`dose_effect_DESeq2_results.csv`**: Full DESeq2 results for the main effect of dose (10 Gy vs. 2 Gy).
*   **`time_dose_interaction_DESeq2_results.csv`**: Full DESeq2 results for the interaction term.

### Visualization and Plots

*   **Figure 1: `PCA_time_dose_effects.pdf`**: A Principal Component Analysis (PCA) plot to visualize sample clustering based on experimental factors.

```{r plot-pca, echo=FALSE, out.width='100%', fig.cap='PCA plot of samples based on experimental factors.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/PCA_time_dose_effects.pdf')
```

*   **Figure 2: `heatmap_top5000_variable_genes.pdf`**: A heatmap of the top 5000 most variable genes across all samples.

```{r plot-heatmap, echo=FALSE, out.width='100%', fig.cap='Heatmap of the top 5000 most variable genes.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/heatmap_top5000_variable_genes.pdf')
```

*   **Figures 3-5: Volcano Plots**: Volcano plots illustrating differential expression for each main effect and the interaction.

```{r plot-volcano-time, echo=FALSE, out.width='100%', fig.cap='Volcano plot for the main effect of time (6d vs. 24h).'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_6d_vs_24h_volcano_plot.pdf')
```

```{r plot-volcano-dose, echo=FALSE, out.width='100%', fig.cap='Volcano plot for the main effect of dose (10Gy vs. 2Gy).'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/dose_10Gy_vs_2Gy_volcano_plot.pdf')
```

```{r plot-volcano-interaction, echo=FALSE, out.width='100%', fig.cap='Volcano plot for the time-dose interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_dose_interaction_volcano_plot.pdf')
```

*   **Figures 6-8: MA Plots**: MA plots showing log2 fold change versus mean normalized counts for each effect.

```{r plot-ma-time, echo=FALSE, out.width='100%', fig.cap='MA plot for the main effect of time.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_6d_vs_24h_MA_plot.pdf')
```

```{r plot-ma-dose, echo=FALSE, out.width='100%', fig.cap='MA plot for the main effect of dose.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/dose_10Gy_vs_2Gy_MA_plot.pdf')
```

```{r plot-ma-interaction, echo=FALSE, out.width='100%', fig.cap='MA plot for the time-dose interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_dose_interaction_MA_plot.pdf')
```

*   **Figures 9-11: Gene Type Annotation Plots**: Bar plots showing the distribution of gene biotypes.

```{r plot-genetype-time, echo=FALSE, out.width='100%', fig.cap='Gene biotype distribution for the time effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_6d_vs_24h_gene_type_annotation.pdf')
```

```{r plot-genetype-dose, echo=FALSE, out.width='100%', fig.cap='Gene biotype distribution for the dose effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/dose_10Gy_vs_2Gy_gene_type_annotation.pdf')
```

```{r plot-genetype-interaction, echo=FALSE, out.width='100%', fig.cap='Gene biotype distribution for the interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/time_dose_interaction_gene_type_annotation.pdf')
```

### Enrichment Analysis (per effect)

For each effect (`Time_Effect_6d_vs_24h`, `Dose_Effect_10Gy_vs_2Gy`, `Time_Dose_Interaction`), the following enrichment files are generated:

#### GSEA (Gene Set Enrichment Analysis)

*   **Figures 12-14: `[effect]_BP_gsea_analysis.pdf`**: Summary plots for GO:BP GSEA results. Details for each BP term are available in the `[effect]_BP_gsea_analysis_plot.pdf` 
        files not shown in the report, please see the accompanying zip file for the full results.

```{r plot-gsea-bp-time, echo=FALSE, out.width='100%', fig.cap='GSEA GO:BP summary for the time effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Time_Effect_6d_vs_24h_BP_gsea_analysis.pdf')
```

```{r plot-gsea-bp-dose, echo=FALSE, out.width='100%', fig.cap='GSEA GO:BP summary for the dose effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Dose_Effect_10Gy_vs_2Gy_BP_gsea_analysis.pdf')
```

```{r plot-gsea-bp-interaction, echo=FALSE, out.width='100%', fig.cap='GSEA GO:BP summary for the interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Time_Dose_Interaction_BP_gsea_analysis.pdf')
```

*   **Figures 15-17: `[effect]_KEGG_gsea_analysis.pdf`**: Summary plots for KEGG GSEA results. Details for each KEGG term are available in the `[effect]_KEGG_gsea_analysis_plot.pdf` 
files not shown in the report, please see the accompanying zip file for the full results.

```{r plot-gsea-kegg-time, echo=FALSE, out.width='100%', fig.cap='GSEA KEGG summary for the time effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Time_Effect_6d_vs_24h_KEGG_gsea_analysis.pdf')
```

```{r plot-gsea-kegg-dose, echo=FALSE, out.width='100%', fig.cap='GSEA KEGG summary for the dose effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Dose_Effect_10Gy_vs_2Gy_KEGG_gsea_analysis.pdf')
```

```{r plot-gsea-kegg-interaction, echo=FALSE, out.width='100%', fig.cap='GSEA KEGG summary for the interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/Time_Dose_Interaction_KEGG_gsea_analysis.pdf')
```
*   **Tables**:
    *   `[effect]_BP_gsea_analysis.tab`: Table of GSEA results for GO Biological Process terms.
    *   `[effect]_KEGG_gsea_analysis.tab`: Table of GSEA results for KEGG pathways.

#### Over-Representation Analysis (ORA)


*   **Figures 18-20: `GO_enrichment_[effect]upGenes_genes.pdf`**: Summary plots for enriched GO:BP terms in the up-regulated gene set.

```{r plot-ora-up-time, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for up-regulated genes in the time effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Time_Effect_6d_vs_24h_upGenes_genes.pdf')
```

```{r plot-ora-up-dose, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for up-regulated genes in the dose effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Dose_Effect_10Gy_vs_2Gy_upGenes_genes.pdf')
```

```{r plot-ora-up-interaction, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for up-regulated genes in the interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Time_Dose_Interaction_upGenes_genes.pdf')
```

*   **Figures 21-23: `GO_enrichment_[effect]downGenes_genes.pdf`**: Similar plots for the down-regulated gene set.

```{r plot-ora-down-time, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for down-regulated genes in the time effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Time_Effect_6d_vs_24h_downGenes_genes.pdf')
```

```{r plot-ora-down-dose, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for down-regulated genes in the dose effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Dose_Effect_10Gy_vs_2Gy_downGenes_genes.pdf')
```

```{r plot-ora-down-interaction, echo=FALSE, out.width='100%', fig.cap='ORA GO:BP for down-regulated genes in the interaction effect.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/multi_factor_analysis/GO_enrichment_Time_Dose_Interaction_downGenes_genes.pdf')
```
*   **Tables**:
    *   `GO_enrichment_[effect]upGenes_genes.tab`: Table of enriched GO:BP terms for up-regulated genes.
    *   `GO_enrichment_[effect]downGenes_genes.tab`: Table of enriched GO:BP terms for down-regulated genes.

---

## 2.2 Single-Factor (Pairwise) Analysis

This analysis performs standard pairwise comparisons between conditions as defined in `comparisons.tsv`. 
For each comparison (e.g., `2Gy24h_vs_NIR`), a set of output files is generated in a dedicated subdirectory within `single_factor_analysis`. 
The filenames follow the patterns described below.

*   **Figure 24: PCA_condition_effects.pdf**: A PCA plot highlighting the effect of different conditions.
```{r plot-pca-single-factor, echo=FALSE, out.width='100%', fig.cap='PCA plot of samples based on experimental factors.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/single_factor_analysis/PCA_condition_effects.pdf')
```
*   **Figure 25: Heatmap_top5000_variable_genes.pdf**: A heatmap of the top 5000 most variable genes across all samples.
```{r plot-heatmap-single-factor, echo=FALSE, out.width='100%', fig.cap='Heatmap of the top 5000 most variable genes.'}
knitr::include_graphics('C:/PROJECTS/Shane/RNAseq/20250604_LH00244_0317_A22WFMGLT3_Harding_Shreya_RNAseq/results_rfstranded/deseq2/single_factor_analysis/heatmap_top5000_variable_genes.pdf')
```
### Differential Expression Outputs (per comparison)

*   **`[comparison]_DESeq2_results.csv`**: The complete DESeq2 results table.
*   **`[comparison]_volcano_plot.pdf`**: A volcano plot highlighting significant genes.
*   **`[comparison]_MA_plot.pdf`**: An MA plot for visualizing differential expression.

As their are too many comparisons, plots are not included in this report. Please see the accompanying zipped folder for all plots. 


### Enrichment Analysis Outputs (per comparison)

The same set of GSEA and ORA files as described in the **Multi-Factor Analysis** section are also generated for each pairwise comparison, using the comparison name (e.g., `2Gy24h_vs_NIR`) as the `[comparison]` placeholder in the filenames.
As their are too many comparisons, plots are not included in this report. Please see the accompanying zipped folder for all plots. 

# END